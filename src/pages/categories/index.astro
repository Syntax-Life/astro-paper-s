---
import { getCollection } from "astro:content";
import Main from "@/layouts/Main.astro";
import Layout from "@/layouts/Layout.astro";
import Header from "@/components/Header.astro";
import Footer from "@/components/Footer.astro";
import getUniqueCategories from "@/utils/getUniqueCategories";
import { SITE } from "@/config";
import { _t } from "@/i18n/lang";
import { getCategoryImageUrl } from "@/utils/categoryImages";

const posts = await getCollection("blog");

let categories = getUniqueCategories(posts);
---

<Layout title={`${_t.categories.title} | ${SITE.title}`}>
  <Header />
  <Main pageTitle={_t.categories.title} pageDesc={_t.categories.desc}>
    <section class="space-y-6">
      <ul
        class="grid grid-cols-2 md:grid-cols-3 gap-2 md:gap-3 lg:gap-2 -mx-4"
        aria-label="分类列表"
      >
        {
          categories.map(({ category, categoryName, count }) => (
            <li>
              <a
                href={`/categories/${category}`}
                aria-label={`查看 ${categoryName} 分类`}
                class="group block overflow-hidden rounded-md transition-colors"
              >
                <div class="w-full overflow-hidden rounded-md" style="aspect-ratio: 16 / 9;">
                  {
                    (getCategoryImageUrl(category) || getCategoryImageUrl(categoryName)) ? (
                      <img
                        src={getCategoryImageUrl(category) || getCategoryImageUrl(categoryName)}
                        alt={`${categoryName} 封面图`}
                        loading="lazy"
                        class="w-full h-full object-cover rounded-md"
                      />
                    ) : (
                      <div class="w-full h-full bg-foreground/10 rounded-md" />
                    )
                  }
                </div>

                <div class="px-3 py-2 flex items-center gap-2">
                  <span class="text-sm font-medium text-accent group-hover:text-accent group-hover:underline group-hover:underline-offset-4 decoration-2">
                    {categoryName}
                  </span>
                  <span class="text-xs sm:text-xs text-foreground/60">
                    {count}
                  </span>
                </div>
              </a>
            </li>
          ))
        }
      </ul>
    </section>
  </Main>
  <Footer />
</Layout>