server {
    listen 80 ; 
    listen 443 ssl ; 
    server_name lhasa.icu www.lhasa.icu; 
    # 日志与通用设置
    index index.php index.html index.htm default.php default.htm default.html; 
    access_log /www/sites/lhasa.icu/log/access.log main; 
    error_log /www/sites/lhasa.icu/log/error.log; 
    # 屏蔽敏感文件
    location ~ ^/(\.user.ini|\.htaccess|\.git|\.env|\.svn|\.project|LICENSE|README\.md)$ {
        return 404; 
    }
    # ACME 校验（保留原有路径，方便续期）
    location ^~ /.well-known/acme-challenge {
        allow all; 
        root /usr/share/nginx/html; 
    }
    if ( $uri ~ "^/\.well-known/.*\.(php|jsp|py|js|css|lua|ts|go|zip|tar\.gz|rar|7z|sql|bak)$" ) {
        return 403; 
    }
    # ---- 301 重定向规则（关键） ----
    # 精准处理 RSS
    location = /rss.xml {
        return 301 https://blog.lhasa.icu/rss.xml; 
    }
    location = /atom.xml {
        return 301 /rss.xml;
    }
    # 其他所有路径一律跳转到新域名（避免多跳，直接到 https://blog.lhasa.icu）
    location / {
        return 301 https://blog.lhasa.icu$request_uri; 
    }
    # --------------------------------
    # SSL（保持原有证书路径）
    ssl_certificate /www/sites/lhasa.icu/ssl/fullchain.pem; 
    ssl_certificate_key /www/sites/lhasa.icu/ssl/privkey.pem; 
    ssl_protocols TLSv1.3 TLSv1.2; 
    ssl_ciphers ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-SHA384:ECDHE-RSA-AES128-SHA256:!aNULL:!eNULL:!EXPORT:!DSS:!DES:!RC4:!3DES:!MD5:!PSK:!KRB5:!SRP:!CAMELLIA:!SEED; 
    ssl_prefer_server_ciphers off; 
    ssl_session_cache shared:SSL:10m; 
    ssl_session_timeout 10m; 
    # 497 错误页保持（可选）
    error_page 497 https://$host$request_uri; 
    # HSTS（可保留；若不想影响子域，去掉 includeSubDomains）
    add_header Strict-Transport-Security "max-age=31536000; includeSubDomains"; 
    http2 on; 
    if ($scheme = http) {
        return 301 https://$host$request_uri; 
    }
    proxy_set_header X-Forwarded-Proto https; 
}